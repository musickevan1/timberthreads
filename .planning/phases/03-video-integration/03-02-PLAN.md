---
phase: 03-video-integration
plan: 02
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - src/components/Hero.tsx
autonomous: true

must_haves:
  truths:
    - "Hero section displays background video on desktop with fast connections"
    - "Hero video autoplays muted in a loop without user interaction"
    - "Hero video has visible pause/play control button"
    - "Hero video shows poster image on slow connections (2G/3G)"
    - "Hero video shows poster image when user has prefers-reduced-motion enabled"
  artifacts:
    - path: "src/components/Hero.tsx"
      provides: "Updated Hero component with video background and connection detection"
      min_lines: 100
      exports: ["default Hero"]
  key_links:
    - from: "Hero.tsx video element"
      to: "public/assets/videos/hero-background.mp4"
      via: "source src attribute"
      pattern: "/assets/videos/hero-background\\.mp4"
    - from: "Hero.tsx connection detection"
      to: "navigator.connection API"
      via: "useEffect hook checking effectiveType"
      pattern: "navigator.*connection.*effectiveType"
    - from: "Hero.tsx fallback"
      to: "Next.js Image component"
      via: "conditional render when showVideo is false"
      pattern: "showVideo.*Image.*hero-poster"
---

<objective>
Replace static background image in Hero component with autoplay background video that degrades gracefully based on connection speed and user preferences.

Purpose: Create immersive hero experience while maintaining performance and accessibility.

Output: Updated Hero.tsx with video background, connection detection, pause/play control, and poster fallback.
</objective>

<execution_context>
@/home/evan/.claude/get-shit-done/workflows/execute-plan.md
@/home/evan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/phase-3-RESEARCH.md
@src/components/Hero.tsx
</context>

<tasks>

<task type="auto">
  <name>Update Hero component with video background and connection detection</name>
  <files>src/components/Hero.tsx</files>
  <action>
Replace the static Image background in Hero.tsx with HTML5 video element following this pattern:

1. **Add React hooks imports** at top (useState, useEffect, useRef)

2. **Add component state:**
   - videoRef: useRef<HTMLVideoElement>(null)
   - showVideo: useState(true) - controls video vs poster display
   - isPlaying: useState(true) - tracks playback state for pause/play button

3. **Add connection detection in useEffect:**
   - Check navigator.connection.effectiveType
   - If '2g' or 'slow-2g': setShowVideo(false)
   - If mobile (window.innerWidth < 768) AND '3g': setShowVideo(false)
   - Check window.matchMedia('(prefers-reduced-motion: reduce)').matches: setShowVideo(false)
   - Add event listener for connection changes
   - Clean up listener on unmount

4. **Add togglePlayback function:**
   - If isPlaying: videoRef.current.pause() and setIsPlaying(false)
   - Else: videoRef.current.play() and setIsPlaying(true)

5. **Replace Image element with conditional render:**
   ```tsx
   {showVideo ? (
     <>
       <video
         ref={videoRef}
         autoPlay
         muted
         loop
         playsInline
         preload="metadata"
         poster="/assets/videos/hero-poster.jpg"
         className="object-cover w-full h-full"
         style={{ objectPosition: 'center 15%' }}
         onLoadedMetadata={() => {
           videoRef.current?.play().catch(() => {
             setShowVideo(false);
           });
         }}
       >
         <source src="/assets/videos/hero-background.mp4" type="video/mp4" />
       </video>

       {/* Pause/Play button */}
       <button
         onClick={togglePlayback}
         className="absolute top-4 right-4 z-20 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-all shadow-lg"
         aria-label={isPlaying ? 'Pause background video' : 'Play background video'}
         title={isPlaying ? 'Pause video' : 'Play video'}
       >
         {isPlaying ? (
           <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
             <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
           </svg>
         ) : (
           <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
             <path d="M8 5v14l11-7z"/>
           </svg>
         )}
       </button>
     </>
   ) : (
     <Image
       src="/assets/videos/hero-poster.jpg"
       alt="Timber & Threads Retreat Center"
       fill
       priority
       quality={100}
       loading="eager"
       sizes="100vw"
       className="object-cover"
       style={{ objectPosition: 'center 15%' }}
     />
   )}
   ```

6. **Keep all existing Hero content unchanged:**
   - Logo, heading, tagline, buttons, scroll indicator
   - All existing className and styling
   - The overlay div (bg-black/50)

**Important:** Use exact video attributes from research: autoPlay, muted, loop, playsInline (camelCase for React). Use preload="metadata" not "auto" for performance.
  </action>
  <verify>
Run development server and check browser console for errors:
```bash
npm run dev
```

Visit http://localhost:3000 and verify:
1. No TypeScript or console errors
2. Video element appears in DOM inspector
3. Connection detection code executes (check console.log if added)
4. Pause/play button renders in top-right corner
  </verify>
  <done>
- Hero.tsx imports useState, useEffect, useRef from React
- Component has videoRef, showVideo, isPlaying state
- useEffect includes connection detection logic checking effectiveType
- Conditional render shows video when showVideo is true, Image when false
- Video element has all required attributes: autoPlay, muted, loop, playsInline, preload="metadata", poster
- Pause/play button renders with onClick handler and proper ARIA labels
- Video source points to /assets/videos/hero-background.mp4
- Fallback Image uses /assets/videos/hero-poster.jpg
- All existing Hero content (logo, heading, buttons) remains unchanged
- No build errors, component compiles successfully
  </done>
</task>

</tasks>

<verification>
Development checks:
- [ ] `npm run dev` runs without errors
- [ ] Hero component renders without console errors
- [ ] Video element visible in DOM with correct attributes
- [ ] Pause/play button visible in top-right corner
- [ ] TypeScript compilation passes
</verification>

<success_criteria>
- Hero component successfully updated with video background
- Video has autoPlay, muted, loop, playsInline, preload="metadata" attributes
- Connection detection implemented using Network Information API
- Pause/play control button renders and is accessible
- Fallback to poster image implemented for slow connections and reduced motion preference
- All existing Hero functionality (logo, buttons, scroll indicator) preserved
- Code compiles without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-video-integration/03-02-SUMMARY.md`
</output>
